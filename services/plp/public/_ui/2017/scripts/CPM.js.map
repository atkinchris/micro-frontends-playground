{"version":3,"sources":["webpack:///./scripts/components/CPM/CPM.jsx","webpack:///./scripts/components/CPM/actions/cpmupdate.js","webpack:///./scripts/components/CPM/presentational/Slider.jsx"],"names":["CPMApp","props","state","cpmdataupdated","cpmdata","cpmobject","saveConfirmed","setCPMData","bind","sendCPMData","updateCPMData","dataSaved","id","value","cpmItem","Object","assign","setState","prevState","setTimeout","config","dataSavedTimeout","cpmService","then","data","map","option","name","getCPMData","createCPMObject","marketingHeader","marketingSubtext1","marketingSubtext2","title","dataSavedText","e","preventDefault","marketingButton","React","Component","$cpmGETURL","$cpmGuestGETURL","$cpmRegisterGETURL","getContainer","document","getElementById","getPaymentContainer","getIsCPM","paymentContainer","dataset","iscpm","JSON","parse","getCSRF","container","csrf","url","params","Promise","resolve","reject","axios","get","response","catch","post","status","error","cpmObject","marketingOptions","slice","item","hasOwnProperty","length","toString","Slider","onToggle","altStyle","changeValue","target","checked","propTypes","PropTypes","string","isRequired","func"],"mappings":"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","file":"CPM.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport cpmService from './actions/cpmupdate';\nimport Slider from './presentational/Slider';\nimport config from './config/config';\nimport axios from 'axios';\n\nclass CPMApp extends React.Component {\n\n  constructor(props){\n    super(props);\n    this.state = {\n      cpmdataupdated: false,\n      cpmdata: [],\n      cpmobject: {},\n      saveConfirmed: false\n    };\n    this.setCPMData = this.setCPMData.bind(this);\n    this.sendCPMData = this.sendCPMData.bind(this);\n    this.updateCPMData = this.updateCPMData.bind(this);\n    this.dataSaved = this.dataSaved.bind(this);\n  }\n\n  updateCPMData(id = '', value = '') {\n    let cpmItem = Object.assign({}, this.state.cpmobject, {\n      [id]: value\n    });\n    this.setState(prevState => ({\n      cpmobject: cpmItem\n    }));\n  }\n\n  dataSaved() {\n    setTimeout(() => {\n      this.setState(prevState => ({\n        saveConfirmed: !prevState.saveConfirmed\n      }));\n    }, config.dataSavedTimeout);\n  }\n\n  sendCPMData() {\n    cpmService.sendCPMData('$cpmGETURL', this.state.cpmobject).then((data) => {\n      this.setState(prevState => ({\n        saveConfirmed: data\n      }));\n      this.dataSaved();\n    });\n  }\n\n  setCPMData(data = []) {\n    let cpmobject = {};\n    data.map((option) => {\n      cpmobject[option.name] = null;\n    });\n\n    this.setState(prevState => ({\n      cpmdataupdated: true,\n      cpmdata: data,\n      cpmobject: cpmobject\n    }));\n  }\n\n  componentWillMount() {\n    if (!this.state.cpmdataupdated) {\n      cpmService.getCPMData('$cpmGETURL').then((data) => {\n        this.setCPMData(cpmService.createCPMObject(data))\n      });\n    }\n  }\n\n  render(){\n    return (\n      <div className=\"ln-u-soft-top\">\n        <h2 className=\"ln-u-h2\">{config.marketingHeader}</h2>\n        <p className=\"ln-u-h5\">{config.marketingSubtext1}</p>\n        <p>{config.marketingSubtext2}</p>\n        <p className=\"ln-u-soft-bottom\">Don't worry, we'll never let other companies use your personal details for marketing.\n          Read our <a href=\"https://help.sainsburys.co.uk/help/website/privacy-policy-commitment\" className=\"ln-u-text-decoration-underline\">privacy policy</a> and <a href=\"/help/cookies\" className=\"ln-u-text-decoration-underline\">cookie policy</a> to learn more.</p>\n        <hr />\n\n        <div className=\"ln-u-3/5@xs ln-u-soft-bottom\">\n          <ul className=\"ln-o-bare-list ln-o-bare-list--spaced ln-u-soft-bottom\">\n            {this.state.cpmdata.map((option) => (\n              <Slider\n                id={option.id}\n                key={option.id}\n                name={option.name}\n                title={option.title}\n                value={option.value}\n                onToggle={(name, value) => this.updateCPMData(name, value)}\n              />\n            ))}\n          </ul>\n\n          <div className={this.state.saveConfirmed ? \"ln-c-form-slider__confirmed ln-c-form-slider__confirmed--show\" : \"ln-c-form-slider__confirmed\" }>\n            <p className=\"ln-u-h5 ln-u-flush-bottom\">{config.dataSavedText}</p>\n          </div>\n          {this.state.cpmdataupdated === true &&\n            <div className=\"ln-u-soft-ends\">\n              <button\n                className=\"ln-c-button ln-c-button--primary\"\n                type=\"submit\"\n                onClick={e => {\n                  e.preventDefault();\n                  this.sendCPMData();\n                }}\n                >{config.marketingButton}</button>\n            </div>\n          }\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default CPMApp;\n","import axios from 'axios';\nimport config from '../config/config';\n\nconst cpmService = (function () {\n  return {\n    $cpmGETURL: '/my-account/marketing-preferences-json',\n    $cpmGuestGETURL: '/checkout/multi/payment-method/tu-marketing-preferences-json',\n    $cpmRegisterGETURL: '/login/tu-marketing-preferences-json',\n    getContainer: function () { return document.getElementById('CPM-account'); },\n    getPaymentContainer: function () { return document.getElementById('paymentDetails'); },\n    getIsCPM: function () {\n      const paymentContainer = this.getPaymentContainer();\n      if (paymentContainer) {\n        const data = paymentContainer.dataset.iscpm;\n        return JSON.parse(data);\n      } else {\n        return false;\n      }\n    },\n    getCSRF: function () {\n      const container = this.getContainer();\n      if (container) {\n        const data = container.dataset.csrf;\n        return data;\n      } else {\n        return false;\n      }\n    },\n    getCPMData: function (url='$cpmGETURL', params={}) {\n      return new Promise((resolve, reject) => {\n        axios.get(this[url], { params: params })\n          .then((response) => {\n            resolve(response.data);\n          })\n          .catch(() => {\n            resolve(null);\n          });\n      });\n    },\n    sendCPMData: function (url='$cpmGETURL', data={}) {\n      return new Promise((resolve, reject) => {\n        axios.post(this[url], data, {\n          params: {\n            \"CSRFToken\": cpmService.getCSRF()\n          }\n        })\n        .then((response) => {\n          if( response.status === 200 ) {\n            resolve(true);\n          }\n        })\n        .catch((error) => {\n          reject(false);\n        });\n      });\n    },\n    createCPMObject: function (data) {\n      let cpmObject = config.marketingOptions.slice();\n\n      cpmObject.map(item => {\n        if (data.hasOwnProperty(item.name)) {\n          item.value = (data[item.name] === null || data[item.name].length === 0) ? null : data[item.name].toString();\n      \t}\n      });\n\n      return cpmObject;\n    }\n  };\n}());\n\nexport default cpmService;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst Slider = ({ id, title, name, value, onToggle, altStyle }) => {\n  return (\n    <li className=\"ln-o-bare-list__item\">\n      <label className={`ln-c-form-slider ${altStyle ? altStyle : ''}`} htmlFor={id}>\n        <span className=\"ln-c-form-slider__title ln-u-font-size-h5\">{title}</span>\n        <input\n          type=\"checkbox\"\n          id={id}\n          name={id}\n          className=\"ln-u-hidden\"\n          onChange={e => {\n            const changeValue = e.target.checked ? 'true' : 'false';\n            onToggle(name, changeValue);\n          }}\n          defaultChecked={(value === 'true' || value === 'li') ? true : false}\n        />\n        <span className=\"ln-c-form-slider__mechanism\">\n          <span className=\"ln-c-form-slider__state\"></span>\n        </span>\n      </label>\n    </li>\n  );\n};\n\nSlider.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  name: PropTypes.string.isRequired,\n  value: PropTypes.string.isRequired,\n  onToggle: PropTypes.func.isRequired\n};\n\nexport default Slider;\n"],"sourceRoot":""}